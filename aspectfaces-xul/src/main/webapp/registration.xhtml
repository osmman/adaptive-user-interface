<?xml version="1.0"?>
<?xml-stylesheet href="chrome://browser/content/browser.css" type="text/css"?>
<?xml-stylesheet href="chrome://browser/skin/" type="text/css"?>
<f:view xmlns:f="http://java.sun.com/jsf/core"
        xmlns:af="http://codingcrayons.com/aspectfaces"
        xmlns:xf="http://xulfaces.sourceforge.net/xulfaces/jsf/facelet"
        locale="#{context.language.concat('_').concat(context.country)}">
    <xf:wizard
            id="registration-wizard"
            title="#{text['action.registration']}"
            onwizardfinish="save()"
            >

        <script>
            function save() {
                try {
                    triggerAction('cmd-save');
                    var theOpener = window.opener;
                    theOpener.location.reload()

                    return true;
                }
                catch (e) {
                    alert(e);
                    return false;
                }
            }

            function isValid(){
                try {
                    triggerAction('cmd-valid-person');
                    XUL_FACES_BRIDGE.updateDOM(XUL_FACES_BRIDGE.responseXml);
                    return !XUL_FACES_BRIDGE.hasErrors(XUL_FACES_BRIDGE.responseXml);
                }
                catch (e) {
                    alert(e);
                    return false;
                }
            }
        </script>

        <xf:commandset id="commandset">
            <xf:command id="cmd-save" action="#{personController.create()}"/>
            <xf:command id="cmd-valid-person" action="#{personController.validate()}" />
        </xf:commandset>


        <xf:wizardpage label="#{text['person']}" onpageadvanced="return isValid()">
            <af:ui instance="#{newPerson}" edit="true"/>
        </xf:wizardpage>

        <xf:wizardpage label="#{text['personInfo']}">
            <af:ui instance="#{newPerson.personInfo}" edit="true" ignore="fullName"/>
        </xf:wizardpage>

        <xf:wizardpage label="#{text['address']}">
            <af:ui instance="#{newPerson.personInfo.address}" edit="true"/>
        </xf:wizardpage>

        <script type="application/x-javascript" src="/aspectfaces-xul/js/xul-logger.js"/>
        <xf:bridge id="bridge" />
    </xf:wizard>

</f:view>